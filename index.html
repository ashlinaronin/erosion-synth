<html>
  <head>
    <title>erosion-synth</title>
  </head>
  <body>
    <div id="instrument">
      <button type="button" id="play-stop">play/stop</button>
    </div>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.68/Tone.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/startaudiocontext@1.2.1/StartAudioContext.min.js"
    ></script>
    <!-- <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/nexusui@2.1.5/dist/NexusUI.min.js"
    ></script> -->
    <!-- <script type="module">
      // const createUi = () => {
      //   const dial = Nexus.Add.Dial("#instrument", { size: [100, 100] });
      //   const slider = Nexus.Add.Slider("#instrument", { size: [25, 100] });
      //   const position = Nexus.Add.Position("#instrument", {
      //     size: [200, 200],
      //   });

      //   dial.on("change", (v) => console.log(v));
      //   slider.on("change", (v) => console.log(v));
      // };
      // createUi();
    </script> -->
    <script type="module">
      let playing = true;

      const play = async () => {
        // instantiate objects
        const conga = new Tone.MembraneSynth({
          pitchDecay: 0.508,
          octaves: 4,
          envelope: {
            attack: 0.01,
            decay: 0.3,
            sustain: 0,
            release: 0.4,
          },
        });
        const congaFilter = new Tone.FeedbackCombFilter(0.0183, 0.75);
        const reverb = new Tone.Reverb({
          decay: 0.8,
          preDelay: 0.01,
          wet: 0.7,
        }).toDestination();


        // connect objects
        conga.connect(congaFilter);
        congaFilter.connect(reverb);
        reverb.toDestination();


        // sequence and transport
        const congaPart = new Tone.Sequence(
          (time, pitch) => {
            conga.triggerAttack(pitch, time, Math.random() * 0.5 + 0.5);
          },
          ["G3", "C4", "C4", "C4"],
          "4n"
        ).start(0);
        Tone.Transport.bpm.value = 115;
        Tone.Transport.start();


        // ui
        document.getElementById("play-stop").addEventListener("click", () => {
          if (playing) {
            Tone.Transport.stop();
            playing = false;
          } else {
            Tone.Transport.start();
            playing = true;
          }
        });
      };

      StartAudioContext(Tone.context).then(play);
    </script>
  </body>
</html>
